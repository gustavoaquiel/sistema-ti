<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GestÃ£o de Tempo - JBS Couros</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Poppins', sans-serif;
}

body{
    background: linear-gradient(135deg,#0a1f44,#123a7a,#1e90ff);
    min-height:100vh;
    color:white;
}


header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:20px 40px;
    background:rgba(0,0,0,0.3);
    backdrop-filter: blur(10px);
}

header img{
    height:40px;
}

nav a{
    color:white;
    margin-left:20px;
    text-decoration:none;
    font-weight:500;
}

nav a:hover{
    opacity:0.7;
}


.form-area{
    background:white;
    color:#333;
    margin:30px auto 0;
    padding:25px;
    width:90%;
    max-width:1000px;
    border-radius:15px;
    box-shadow:0 10px 25px rgba(0,0,0,0.2);
    display:flex;
    flex-wrap:wrap;
    gap:15px;
    align-items:center;
}

.form-area input, .form-area select{
    padding:10px;
    border-radius:8px;
    border:1px solid #ccc;
}

.form-area input[type="text"]{
    flex:2;
}

.form-area input[type="date"]{
    flex:1;
}

.form-area select{
    flex:1;
}

.form-area button{
    background:#0a1f44;
    color:white;
    border:none;
    padding:10px 20px;
    border-radius:8px;
    cursor:pointer;
}

.form-area button:hover{
    background:#062a66;
}


.kanban{
    display:flex;
    gap:20px;
    padding:20px;
    flex-wrap:wrap;
}

.coluna{
    flex:1;
    min-width:300px;
    background:rgba(255,255,255,0.15);
    backdrop-filter: blur(12px);
    padding:20px;
    border-radius:15px;
}

.coluna h3{
    margin-bottom:15px;
}


.card{
    background:white;
    color:#333;
    padding:15px;
    border-radius:10px;
    margin-bottom:10px;
    box-shadow:0 5px 15px rgba(0,0,0,0.15);
    position:relative;
}

.card small{
    display:block;
    margin-top:5px;
    color:#666;
}


.card-actions{
    position:absolute;
    top:10px;
    right:10px;
}

.card-actions i{
    margin-left:10px;
    cursor:pointer;
}

.fa-check{
    color:green;
}

.fa-trash{
    color:red;
}

.concluida{
    opacity:0.6;
    text-decoration:line-through;
}


.footer-tarefas{
    text-align:center;
    margin:20px auto 30px;
    font-size:13px;
}

.footer-tarefas a{
    color:white;
    text-decoration:underline;
}
</style>
</head>

<body>

<header>
    <img src="imagens/logojbs.jfif">
    <nav>
        <a href="tarefas.html">Tarefas</a>
        <a href="computadores.html">Computadores</a>
        <a href="index.html" onclick="logout()">Sair</a>
    </nav>
</header>

<div class="form-area">
    <input type="text" id="titulo" placeholder="TÃ­tulo da tarefa">
    <input type="text" id="descricao" placeholder="DescriÃ§Ã£o detalhada">
    <select id="prioridade">
        <option value="alta">ðŸ”´ Alta</option>
        <option value="media">ðŸŸ  MÃ©dia</option>
        <option value="baixa">ðŸŸ¢ Baixa</option>
    </select>
    <input type="date" id="data">
    <button onclick="adicionarTarefa()">Adicionar</button>
</div>

<div class="kanban">
    <div class="coluna" id="alta"><h3>ðŸ”´ Alta</h3></div>
    <div class="coluna" id="media"><h3>ðŸŸ  MÃ©dia</h3></div>
    <div class="coluna" id="baixa"><h3>ðŸŸ¢ Baixa</h3></div>
</div>


<div class="footer-tarefas">
    <p>Qualquer dÃºvida: <a href="mailto:gustavo.aquiel@jbs.com.br">gustavo.aquiel@jbs.com.br</a></p>
    <p>Desenvolvido por: <strong>Gustavo Aquiel</strong></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { 
    getAuth, 
    onAuthStateChanged,
    signOut 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { 
    getFirestore, 
    collection, 
    addDoc, 
    getDocs, 
    deleteDoc, 
    doc, 
    updateDoc, 
    query, 
    where 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAdG2I9naqVe1tT2Y1dRAD-McuGaJiyTNU",
  authDomain: "sistema-ti-jbs.firebaseapp.com",
  projectId: "sistema-ti-jbs",
  storageBucket: "sistema-ti-jbs.firebasestorage.app",
  messagingSenderId: "1033258512541",
  appId: "1:1033258512541:web:1b9755d5957c7e37736474"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;
let tarefas = []; 


onAuthStateChanged(auth, (user) => {
    if (!user) {
        window.location.href = "login.html";
        return;
    }
    
    currentUser = user;
    carregarTarefas();
});


async function carregarTarefas() {
    try {
        const consulta = query(
            collection(db, "tarefas"),
            where("uid", "==", currentUser.uid)
        );

        const snapshot = await getDocs(consulta);
        tarefas = [];
        
        snapshot.forEach(doc => {
            tarefas.push({
                id: doc.id, 
                ...doc.data()
            });
        });
        
        renderizar(); 
    } catch (error) {
        console.error("Erro ao carregar tarefas:", error);
        alert("Erro ao carregar tarefas. Tente novamente.");
    }
}


function renderizar() {
    document.getElementById("alta").innerHTML = "<h3>ðŸ”´ Alta</h3>";
    document.getElementById("media").innerHTML = "<h3>ðŸŸ  MÃ©dia</h3>";
    document.getElementById("baixa").innerHTML = "<h3>ðŸŸ¢ Baixa</h3>";

    tarefas.forEach((tarefa) => {
        const card = document.createElement("div");
        card.className = "card";
        if (tarefa.concluida) card.classList.add("concluida");

        card.innerHTML = `
            <div class="card-actions">
                <i class="fa-solid fa-check" onclick="concluir('${tarefa.id}')"></i>
                <i class="fa-solid fa-trash" onclick="excluir('${tarefa.id}')"></i>
            </div>
            <strong>${tarefa.titulo}</strong>
            <small>${tarefa.descricao || ""}</small>
            <small>ðŸ“… ${tarefa.data || ""}</small>
        `;

        document.getElementById(tarefa.prioridade).appendChild(card);
    });
}


window.adicionarTarefa = async function() {
    const titulo = document.getElementById("titulo").value;
    const descricao = document.getElementById("descricao").value;
    const prioridade = document.getElementById("prioridade").value;
    const data = document.getElementById("data").value;

    if (!titulo) {
        alert("Digite um tÃ­tulo");
        return;
    }

    try {
        
        const docRef = await addDoc(collection(db, "tarefas"), {
            uid: currentUser.uid,
            titulo,
            descricao,
            prioridade,
            data,
            concluida: false,
            dataCriacao: new Date().toISOString()
        });

        
        tarefas.push({
            id: docRef.id,
            uid: currentUser.uid,
            titulo,
            descricao,
            prioridade,
            data,
            concluida: false
        });

        renderizar();

        
        document.getElementById("titulo").value = "";
        document.getElementById("descricao").value = "";
        document.getElementById("data").value = "";
    } catch (error) {
        console.error("Erro ao adicionar tarefa:", error);
        alert("Erro ao adicionar tarefa. Tente novamente.");
    }
}


window.concluir = async function(id) {
    try {
        
        const tarefa = tarefas.find(t => t.id === id);
        if (!tarefa) return;

        
        const docRef = doc(db, "tarefas", id);
        await updateDoc(docRef, {
            concluida: !tarefa.concluida
        });

        
        tarefa.concluida = !tarefa.concluida;
        renderizar();
    } catch (error) {
        console.error("Erro ao concluir tarefa:", error);
        alert("Erro ao atualizar tarefa. Tente novamente.");
    }
}


window.excluir = async function(id) {
    if (!confirm("Deseja excluir esta tarefa?")) return;

    try {
        
        await deleteDoc(doc(db, "tarefas", id));

        
        tarefas = tarefas.filter(t => t.id !== id);
        renderizar();
    } catch (error) {
        console.error("Erro ao excluir tarefa:", error);
        alert("Erro ao excluir tarefa. Tente novamente.");
    }
}


window.logout = function() {
    signOut(auth).then(() => {
        window.location.href = "index.html";
    });
}


</script>

</body>
</html>
