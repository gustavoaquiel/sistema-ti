<script type="module">

import { auth, db } from "./firebase.js";
import { collection, addDoc, getDocs, query, where }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

let usuarioAtual;

auth.onAuthStateChanged(user=>{
if(user){
    usuarioAtual = user.uid;
    carregar();
}
});

async function salvarTarefa(){

await addDoc(collection(db,"tarefas"),{
    titulo: titulo.value,
    descricao: descricao.value,
    userId: usuarioAtual,
    data: new Date()
});

carregar();
}

async function carregar(){

const q = query(
    collection(db,"tarefas"),
    where("userId","==",usuarioAtual)
);

const querySnapshot = await getDocs(q);

lista.innerHTML="";

querySnapshot.forEach(doc=>{
    const tarefa = doc.data();
    lista.innerHTML += `<li>${tarefa.titulo}</li>`;
});

}

window.salvarTarefa = salvarTarefa;

</script>
